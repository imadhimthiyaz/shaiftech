<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Product Catalogue</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
	<style>
		:root {
			--brand: #0d6efd;
			--brand-600: #0b5ed7;
			--bg-soft: #f6f7fb;
		}
		body { background: var(--bg-soft); }
		.navbar { box-shadow: 0 1px 2px rgba(16,24,40,.04), 0 1px 3px rgba(16,24,40,.1); }
		.card { border: 1px solid #eef0f4; }
		.card-title { font-weight: 600; }
		.stat { background:#f8fafc; border:1px solid #eef0f4; border-radius: .5rem; padding:.75rem 1rem; }
		.toast-container { z-index: 1080; }
		.table > :not(caption) > * > * { padding-top: .9rem; padding-bottom: .9rem; }
		.hero {
			background: radial-gradient(1200px 400px at 10% -10%, rgba(13,110,253,.10), transparent),
				radial-gradient(800px 300px at 90% -20%, rgba(13,110,253,.08), transparent);
		}
		.card-elevated { box-shadow: 0 8px 24px rgba(16,24,40,.06); }
		.product-card .price { color: var(--brand-600); font-weight: 600; }
		.form-floating > .form-control::placeholder { color: transparent; }
		.skeleton { position: relative; overflow: hidden; background: #eef0f4; border-radius: .5rem; }
		.skeleton::after { content:""; position:absolute; inset:0; background: linear-gradient(90deg, transparent, rgba(255,255,255,.55), transparent); transform: translateX(-100%); animation: shine 1.2s infinite; }
		@keyframes shine { to { transform: translateX(100%); } }
	</style>
	<script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
	<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
	<script crossorigin src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>
	<nav class="navbar navbar-expand-lg bg-white">
		<div class="container">
			<a class="navbar-brand d-flex align-items-center gap-2" href="#">
				<i class="bi bi-box-seam-fill text-primary"></i>
				<span class="fw-semibold">Product Catalogue</span>
			</a>
		</div>
	</nav>

	<header class="hero border-bottom bg-white">
		<div class="container py-4 py-lg-5">
			<div class="row align-items-center g-4">
				<div class="col-12 col-lg-7">
					<h1 class="display-6 fw-semibold mb-2">Manage your catalogue with ease</h1>
					<p class="text-secondary mb-0">Add new products, view inventory and track value in a single, responsive dashboard.</p>
				</div>
			</div>
		</div>
	</header>

	<div class="container py-4">
		<div id="app"></div>
	</div>

	<div class="toast-container position-fixed top-0 end-0 p-3" id="toast-container"></div>

	<script type="text/babel">
		const API_BASE = '/api';
		const currency = new Intl.NumberFormat(undefined, { style: 'currency', currency: 'USD' });

		function useProducts() {
			const [products, setProducts] = React.useState([]);
			const [loading, setLoading] = React.useState(false);
			const [error, setError] = React.useState(null);

			const fetchProducts = React.useCallback(async () => {
				setLoading(true);
				setError(null);
				try {
					const res = await fetch(`${API_BASE}/products`);
					if (!res.ok) throw new Error('Failed to load products');
					const data = await res.json();
					setProducts(data);
				} catch (e) {
					setError(e.message);
				} finally {
					setLoading(false);
				}
			}, []);

			React.useEffect(() => { fetchProducts(); }, [fetchProducts]);

			return { products, setProducts, loading, error, refresh: fetchProducts };
		}

		function Toast({ type, message }) {
			React.useEffect(() => {
				const container = document.getElementById('toast-container');
				const el = document.createElement('div');
				el.className = `toast align-items-center text-bg-${type} border-0`;
				el.setAttribute('role','alert');
				el.innerHTML = `<div class="d-flex"><div class="toast-body">${message}</div><button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button></div>`;
				container.append(el);
				const t = new bootstrap.Toast(el, { delay: 2500 });
				t.show();
				return () => el.remove();
			}, [type, message]);
			return null;
		}

		function ProductForm({ onCreated, notify }) {
			const [productName, setProductName] = React.useState('');
			const [price, setPrice] = React.useState('');
			const [description, setDescription] = React.useState('');
			const [submitting, setSubmitting] = React.useState(false);

			const validate = () => {
				if (!productName.trim()) return 'Product name is required';
				if (!price.trim()) return 'Price is required';
				if (!/^\d+(?:\.\d{1,2})?$/.test(price)) return 'Price must be positive with up to two decimals';
				if (parseFloat(price) <= 0) return 'Price must be greater than zero';
				return null;
			};

			const handleSubmit = async (e) => {
				e.preventDefault();
				const err = validate();
				if (err) { notify({ type: 'danger', message: err }); return; }

				setSubmitting(true);
				try {
					const res = await fetch(`${API_BASE}/products`, {
						method: 'POST',
						headers: { 'Content-Type': 'application/json', 'X-Requested-With': 'XMLHttpRequest' },
						body: JSON.stringify({ product_name: productName.trim(), price: price.trim(), description: description.trim() || null })
					});
					if (res.status === 422) {
						const data = await res.json();
						const first = Object.values(data.errors || {})[0]?.[0] || 'Validation error';
						notify({ type: 'danger', message: first });
						return;
					}
					if (!res.ok) throw new Error('Failed to create product');
					const created = await res.json();
					notify({ type: 'success', message: 'Product created successfully' });
					onCreated(created);
					setProductName('');
					setPrice('');
					setDescription('');
				} catch (e) {
					notify({ type: 'danger', message: e.message });
				} finally {
					setSubmitting(false);
				}
			};

			return (
				<div className="card shadow-sm">
					<div className="card-body">
						<h5 className="card-title mb-3"><i className="bi bi-plus-circle me-2 text-primary"></i>Add Product</h5>
						<form onSubmit={handleSubmit} className="vstack gap-3">
							<div className="row g-3">
								<div className="col-12">
									<label className="form-label">Product Name</label>
									<input className="form-control" value={productName} onChange={(e)=>setProductName(e.target.value)} placeholder="e.g., iPhone 15" />
								</div>
								<div className="col-6">
									<label className="form-label">Price</label>
									<div className="input-group">
										<span className="input-group-text"><i className="bi bi-currency-dollar"></i></span>
										<input className="form-control" value={price} onChange={(e)=>setPrice(e.target.value)} placeholder="999.99" />
									</div>
								</div>
								<div className="col-6">
									<label className="form-label">Description <span className="text-muted">(optional)</span></label>
									<input className="form-control" value={description} onChange={(e)=>setDescription(e.target.value)} placeholder="Short details" />
								</div>
							</div>
							<div className="d-flex gap-2">
								<button disabled={submitting} className="btn btn-primary px-4">
									{submitting ? 'Adding…' : 'Add Product'}
								</button>
							</div>
						</form>
					</div>
				</div>
			);
		}

		function ProductsPanel({ products, loading, error, onRefresh, query, setQuery }) {
			const total = products.reduce((sum, p) => sum + Number(p.price || 0), 0);
			return (
				<div className="card shadow-sm h-100">
					<div className="card-body d-flex flex-column">
						<div className="d-flex flex-wrap align-items-center justify-content-between gap-2 mb-3">
							<h5 className="card-title m-0"><i className="bi bi-list-ul me-2 text-primary"></i>Products</h5>
							<div className="d-flex gap-2">
								<div className="input-group">
									<span className="input-group-text"><i className="bi bi-search"></i></span>
									<input className="form-control" placeholder="Search name…" value={query} onChange={(e)=>setQuery(e.target.value)} />
								</div>
								<button className="btn btn-outline-secondary" onClick={onRefresh} disabled={loading}>
									{loading ? 'Refreshing…' : 'Refresh'}
								</button>
							</div>
						</div>

						<div className="row g-3 mb-3">
							<div className="col-6 col-lg-3">
								<div className="stat">
									<div className="text-muted small">Items</div>
									<div className="fs-5 fw-semibold">{products.length}</div>
								</div>
							</div>
							<div className="col-6 col-lg-3">
								<div className="stat">
									<div className="text-muted small">Total value</div>
									<div className="fs-5 fw-semibold">{currency.format(total)}</div>
								</div>
							</div>
						</div>

						<div className="table-responsive">
							<table className="table table-hover align-middle">
								<thead className="table-light">
									<tr>
										<th>Name</th>
										<th className="text-end">Price</th>
										<th>Description</th>
										<th>Added</th>
									</tr>
								</thead>
								<tbody>
									{products.length === 0 && (
										<tr><td colSpan="4" className="text-center text-muted py-4">No products yet.</td></tr>
									)}
									{products.map(p => (
										<tr key={p.id}>
											<td className="fw-medium">{p.product_name}</td>
											<td className="text-end">{currency.format(Number(p.price))}</td>
											<td className="text-truncate" style={{maxWidth:'22ch'}}>{p.description || '-'}</td>
											<td>{new Date(p.created_at).toLocaleString()}</td>
										</tr>
									))}
								</tbody>
							</table>
						</div>
					</div>
				</div>
			);
		}

		function App() {
			const { products, setProducts, loading, error, refresh } = useProducts();
			const [notice, setNotice] = React.useState(null);
			const [query, setQuery] = React.useState('');

			const notify = (n) => setNotice(n);
			React.useEffect(() => { if (notice) { /* mount toast */ } }, [notice]);
			const onCreated = (created) => { setProducts(prev => [created, ...prev]); };

			const filtered = React.useMemo(() => {
				const q = query.trim().toLowerCase();
				if (!q) return products;
				return products.filter(p => String(p.product_name).toLowerCase().includes(q));
			}, [products, query]);

			return (
				<>
					{notice && <Toast type={notice.type} message={notice.message} />}
					<div className="row g-4">
						<div className="col-12 col-lg-5">
							<ProductForm onCreated={onCreated} notify={notify} />
						</div>
						<div className="col-12 col-lg-7">
							{error && <div className="alert alert-danger mb-3"><i className="bi bi-exclamation-triangle me-2"></i>{error}</div>}
							<ProductsPanel products={filtered} loading={loading} error={error} onRefresh={refresh} query={query} setQuery={setQuery} />
						</div>
					</div>
				</>
			);
		}

		const root = ReactDOM.createRoot(document.getElementById('app'));
		root.render(<App />);
	</script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>


